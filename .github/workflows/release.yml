name: release

on:
  workflow_dispatch:
    inputs:
      qemu_repo:
        description: 'QEMU source git repo'
        required: false
        type: string
      qemu_ref:
        description: 'QEMU git ref (ie. tag, branch or sha)'
        required: false
        type: string
      qemu_version:
        description: 'QEMU version (e.g. v5.2.0)'
        required: true
        type: string
      target:
        description: 'Bake target'
        required: true
        default: 'mainline'
        type: choice
        options:
          - mainline
          - buildkit
          - desktop
      latest:
        description: 'Create latest tag'
        required: true
        default: false
        type: boolean
      dry-run:
        description: 'Dry run'
        required: false
        default: true
        type: boolean

jobs:
  release:
    uses: ./.github/workflows/.build.yml
    secrets: inherit
    with:
      target: ${{ inputs.target }}
      release: true
      qemu_repo: ${{ inputs.qemu_repo }}
      qemu_ref: ${{ inputs.qemu_ref }}
      qemu_version: ${{ inputs.qemu_version }}
      latest: ${{ inputs.latest }}
      dry-run: ${{ inputs.dry-run }}
